#!/bin/bash

FILE="$1"
CMD="$2"
shift 2

if [[ ! -e "$FILE" ]]; then
    exit 1
fi

read -ra args <"$FILE"

case "$CMD" in
    run)
        echo git diff "${args[@]}" "$@"
        git -c core.pager='less -+F -KMc' diff --color=always "${args[@]}" "$@" \
            | sed 1,4d
        ;;
    toggle-cached)
        if [[ " ${args[*]} " == *" --cached "* ]]; then
            read -ra args <<<"${args[@]/--cached/}"
        else
            args=(--cached "${args[@]}")
        fi
        echo "${args[@]}" > "${FILE}"
        ;;
    *)
        exit 1
        ;;
esac
